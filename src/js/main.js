// Floor Plan

var plnarData = {
    "id": "0F32AD08-624D-418A-B255-FFF0C37742E3",
    "version": "AAAAAAAAP6k=",
    "createdAt": "2017-12-18T18:56:26.360Z",
    "updatedAt": "2017-12-24T15:28:48.685Z",
    "address": "{\"street2\":\"\",\"country\":\"\",\"state\":\"Dd\",\"city\":\"Djd\",\"street1\":\"F\",\"postalCode\":\"12345\"}",
    "rooms": "[{\"closed\":false,\"area\":23.29664039554671,\"longitude\":-97.777772974313962,\"wallArea\":58.064868660670825,\"latitude\":30.403127898490432,\"ceilingHeight\":2.8422541618347168,\"roomObjects\":[{\"closed\":true,\"area\":23.296642303466797,\"segments\":[{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.0127267837524414,\"isOverlapping\":false,\"x1\":-1.0718711614608765,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-0.75841188430786133,\"name\":null,\"x0\":-1.2508270740509033},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.0640788078308105,\"isOverlapping\":false,\"x1\":-1.1646676063537598,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.0127267837524414,\"name\":null,\"x0\":-1.0718711614608765},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.6866917610168457,\"isOverlapping\":false,\"x1\":-0.75349056720733643,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.0640788078308105,\"name\":null,\"x0\":-1.1646676063537598},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.6336966753005981,\"isOverlapping\":false,\"x1\":-0.6676638126373291,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.6866917610168457,\"name\":null,\"x0\":-0.75349056720733643},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.6887226104736328,\"isOverlapping\":false,\"x1\":-0.59700250625610352,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.6336966753005981,\"name\":null,\"x0\":-0.6676638126373291},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.4769201278686523,\"isOverlapping\":false,\"x1\":-0.27834832668304443,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.6887226104736328,\"name\":null,\"x0\":-0.59700250625610352},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.502028226852417,\"isOverlapping\":false,\"x1\":-0.10635031759738922,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.4769201278686523,\"name\":null,\"x0\":-0.27834832668304443},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.2544084787368774,\"isOverlapping\":false,\"x1\":0.27141231298446655,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.502028226852417,\"name\":null,\"x0\":-0.10635031759738922},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.4731788635253906,\"isOverlapping\":false,\"x1\":0.42230206727981567,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.2544084787368774,\"name\":null,\"x0\":0.27141231298446655},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-0.41308355331420898,\"isOverlapping\":false,\"x1\":1.7960178852081299,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.4731788635253906,\"name\":null,\"x0\":0.42230206727981567},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-0.26203817129135132,\"isOverlapping\":false,\"x1\":1.680595874786377,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-0.41308355331420898,\"name\":null,\"x0\":1.7960178852081299},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":0.16918750107288361,\"isOverlapping\":false,\"x1\":2.2612674236297607,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-0.26203817129135132,\"name\":null,\"x0\":1.680595874786377},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":0.028326183557510376,\"isOverlapping\":false,\"x1\":2.3593847751617432,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":0.16918750107288361,\"name\":null,\"x0\":2.2612674236297607},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.046495795249939,\"isOverlapping\":false,\"x1\":3.781374454498291,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":0.028326183557510376,\"name\":null,\"x0\":2.3593847751617432},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.1791208982467651,\"isOverlapping\":false,\"x1\":3.6843571662902832,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.046495795249939,\"name\":null,\"x0\":3.781374454498291},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.3488445281982422,\"isOverlapping\":false,\"x1\":3.9243998527526855,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.1791208982467651,\"name\":null,\"x0\":3.6843571662902832},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.4260908365249634,\"isOverlapping\":false,\"x1\":3.9354195594787598,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.3488445281982422,\"name\":null,\"x0\":3.9243998527526855},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":2.2171368598937988,\"isOverlapping\":false,\"x1\":4.0482668876647949,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.4260908365249634,\"name\":null,\"x0\":3.9354195594787598},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":2.3430514335632324,\"isOverlapping\":false,\"x1\":4.0662293434143066,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":2.2171368598937988,\"name\":null,\"x0\":4.0482668876647949},{\"z1\":-1.1109311580657959,\"isOverlapped\":false,\"y1\":4.3087916374206543,\"isOverlapping\":false,\"x1\":2.6968264579772949,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":2.3430514335632324,\"name\":null,\"x0\":4.0662293434143066},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":4.5111689567565918,\"isOverlapping\":false,\"x1\":1.7228385210037231,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109311580657959,\"y0\":4.3087916374206543,\"name\":null,\"x0\":2.6968264579772949},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":4.393805980682373,\"isOverlapping\":false,\"x1\":1.5476164817810059,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":4.5111689567565918,\"name\":null,\"x0\":1.7228385210037231},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":3.8362200260162354,\"isOverlapping\":false,\"x1\":0.71514403820037842,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":4.393805980682373,\"name\":null,\"x0\":1.5476164817810059},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":3.7132775783538818,\"isOverlapping\":false,\"x1\":0.53159183263778687,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":3.8362200260162354,\"name\":null,\"x0\":0.71514403820037842},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":3.2606587409973145,\"isOverlapping\":false,\"x1\":-0.36385992169380188,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":3.7132775783538818,\"name\":null,\"x0\":0.53159183263778687},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.8162034749984741,\"isOverlapping\":false,\"x1\":-2.5023443698883057,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":3.2606587409973145,\"name\":null,\"x0\":-0.36385992169380188},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-0.43614113330841064,\"isOverlapping\":false,\"x1\":-0.81115365028381348,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.8162034749984741,\"name\":null,\"x0\":-2.5023443698883057},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-0.75841188430786133,\"isOverlapping\":false,\"x1\":-1.2508270740509033,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-0.43614113330841064,\"name\":null,\"x0\":-0.81115365028381348}],\"geometryIdentifier\":\"polygon\",\"length\":6.1998915672302246,\"typeIdentifier\":\"floorPlan\",\"width\":6.5685739517211914,\"perimeter\":20.429162979125977,\"name\":null,\"orientationIdentifier\":\"horizontal\"},{\"closed\":true,\"area\":23.296640396118164,\"segments\":[{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.0127267837524414,\"isOverlapping\":false,\"x1\":-1.0718711614608765,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-0.75841188430786133,\"name\":null,\"x0\":-1.2508270740509033},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.0640788078308105,\"isOverlapping\":false,\"x1\":-1.1646676063537598,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.0127267837524414,\"name\":null,\"x0\":-1.0718711614608765},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.6866917610168457,\"isOverlapping\":false,\"x1\":-0.75349056720733643,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.0640788078308105,\"name\":null,\"x0\":-1.1646676063537598},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.6336966753005981,\"isOverlapping\":false,\"x1\":-0.6676638126373291,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.6866917610168457,\"name\":null,\"x0\":-0.75349056720733643},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.6887226104736328,\"isOverlapping\":false,\"x1\":-0.59700250625610352,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.6336966753005981,\"name\":null,\"x0\":-0.6676638126373291},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.4769201278686523,\"isOverlapping\":false,\"x1\":-0.27834832668304443,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.6887226104736328,\"name\":null,\"x0\":-0.59700250625610352},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.502028226852417,\"isOverlapping\":false,\"x1\":-0.10635031759738922,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.4769201278686523,\"name\":null,\"x0\":-0.27834832668304443},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.2544084787368774,\"isOverlapping\":false,\"x1\":0.27141231298446655,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.502028226852417,\"name\":null,\"x0\":-0.10635031759738922},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-1.4731788635253906,\"isOverlapping\":false,\"x1\":0.42230206727981567,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.2544084787368774,\"name\":null,\"x0\":0.27141231298446655},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-0.41308355331420898,\"isOverlapping\":false,\"x1\":1.7960178852081299,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-1.4731788635253906,\"name\":null,\"x0\":0.42230206727981567},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-0.26203817129135132,\"isOverlapping\":false,\"x1\":1.680595874786377,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-0.41308355331420898,\"name\":null,\"x0\":1.7960178852081299},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":0.16918750107288361,\"isOverlapping\":false,\"x1\":2.2612674236297607,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-0.26203817129135132,\"name\":null,\"x0\":1.680595874786377},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":0.028326183557510376,\"isOverlapping\":false,\"x1\":2.3593847751617432,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":0.16918750107288361,\"name\":null,\"x0\":2.2612674236297607},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":1.046495795249939,\"isOverlapping\":false,\"x1\":3.781374454498291,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":0.028326183557510376,\"name\":null,\"x0\":2.3593847751617432},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":1.1791208982467651,\"isOverlapping\":false,\"x1\":3.6843571662902832,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":1.046495795249939,\"name\":null,\"x0\":3.781374454498291},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":1.3488445281982422,\"isOverlapping\":false,\"x1\":3.9243998527526855,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":1.1791208982467651,\"name\":null,\"x0\":3.6843571662902832},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":2.3430514335632324,\"isOverlapping\":false,\"x1\":4.0662293434143066,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":1.3488445281982422,\"name\":null,\"x0\":3.9243998527526855},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":4.3087916374206543,\"isOverlapping\":false,\"x1\":2.6968264579772949,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":2.3430514335632324,\"name\":null,\"x0\":4.0662293434143066},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":4.5111689567565918,\"isOverlapping\":false,\"x1\":1.7228385210037231,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":4.3087916374206543,\"name\":null,\"x0\":2.6968264579772949},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":3.7132775783538818,\"isOverlapping\":false,\"x1\":0.53159183263778687,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":4.5111689567565918,\"name\":null,\"x0\":1.7228385210037231},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":3.2606587409973145,\"isOverlapping\":false,\"x1\":-0.36385992169380188,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":3.7132775783538818,\"name\":null,\"x0\":0.53159183263778687},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":1.8162034749984741,\"isOverlapping\":false,\"x1\":-2.5023443698883057,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":3.2606587409973145,\"name\":null,\"x0\":-0.36385992169380188},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-0.43614113330841064,\"isOverlapping\":false,\"x1\":-0.81115365028381348,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":1.8162034749984741,\"name\":null,\"x0\":-2.5023443698883057},{\"z1\":1.7313232421875,\"isOverlapped\":false,\"y1\":-0.75841188430786133,\"isOverlapping\":false,\"x1\":-1.2508270740509033,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":1.7313232421875,\"y0\":-0.43614113330841064,\"name\":null,\"x0\":-0.81115365028381348}],\"geometryIdentifier\":\"polygon\",\"height\":2.8422541618347168,\"typeIdentifier\":\"ceiling\",\"width\":6.5685739517211914,\"length\":6.1998915672302246,\"perimeter\":20.429162979125977,\"name\":\"Floor Plan\",\"orientationIdentifier\":\"horizontal\"},{\"closed\":true,\"area\":1.859993577003479,\"segments\":[{\"z1\":1.3819156885147095,\"isOverlapped\":false,\"y1\":-1.6866917610168457,\"isOverlapping\":false,\"x1\":-0.75349056720733643,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"top\",\"z0\":1.3819156885147095,\"y0\":-1.0640788078308105,\"name\":null,\"x0\":-1.1646676063537598},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.6866917610168457,\"isOverlapping\":false,\"x1\":-0.75349056720733643,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.3819156885147095,\"y0\":-1.6866917610168457,\"name\":null,\"x0\":-0.75349056720733643},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":-1.0640788078308105,\"isOverlapping\":true,\"x1\":-1.1646676063537598,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":-1.6866917610168457,\"name\":null,\"x0\":-0.75349056720733643},{\"z1\":1.3819156885147095,\"isOverlapped\":false,\"y1\":-1.0640788078308105,\"isOverlapping\":false,\"x1\":-1.1646676063537598,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":-1.0640788078308105,\"name\":null,\"x0\":-1.1646676063537598}],\"geometryIdentifier\":\"rectangle\",\"height\":2.4928467273712158,\"typeIdentifier\":\"opening\",\"width\":0.74613231420516968,\"perimeter\":6.4779582023620605,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":4.3115262985229492,\"segments\":[{\"z1\":1.3543184995651245,\"isOverlapped\":false,\"y1\":1.046495795249939,\"isOverlapping\":false,\"x1\":3.781374454498291,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"top\",\"z0\":1.3543184995651245,\"y0\":0.028326183557510376,\"name\":null,\"x0\":2.3593847751617432},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.046495795249939,\"isOverlapping\":false,\"x1\":3.781374454498291,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.3543184995651245,\"y0\":1.046495795249939,\"name\":null,\"x0\":3.781374454498291},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":0.028326183557510376,\"isOverlapping\":true,\"x1\":2.3593847751617432,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.046495795249939,\"name\":null,\"x0\":3.781374454498291},{\"z1\":1.3543184995651245,\"isOverlapped\":false,\"y1\":0.028326183557510376,\"isOverlapping\":false,\"x1\":2.3593847751617432,\"typeIdentifier\":\"opening\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":0.028326183557510376,\"name\":null,\"x0\":2.3593847751617432}],\"geometryIdentifier\":\"rectangle\",\"height\":2.4652495384216309,\"typeIdentifier\":\"opening\",\"width\":1.7489207983016968,\"perimeter\":8.4283409118652344,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":1.7297873497009277,\"segments\":[{\"z1\":1.053861141204834,\"isOverlapped\":false,\"y1\":2.2171368598937988,\"isOverlapping\":false,\"x1\":4.0482668876647949,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"top\",\"z0\":1.053861141204834,\"y0\":1.4260908365249634,\"name\":null,\"x0\":3.9354195594787598},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":2.2171368598937988,\"isOverlapping\":false,\"x1\":4.0482668876647949,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.053861141204834,\"y0\":2.2171368598937988,\"name\":null,\"x0\":4.0482668876647949},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.4260908365249634,\"isOverlapping\":true,\"x1\":3.9354195594787598,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":2.2171368598937988,\"name\":null,\"x0\":4.0482668876647949},{\"z1\":1.053861141204834,\"isOverlapped\":false,\"y1\":1.4260908365249634,\"isOverlapping\":false,\"x1\":3.9354195594787598,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":1.4260908365249634,\"name\":null,\"x0\":3.9354195594787598}],\"geometryIdentifier\":\"rectangle\",\"height\":2.1647920608520508,\"typeIdentifier\":\"door\",\"width\":0.79905468225479126,\"perimeter\":5.9276933670043945,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":2.1527149677276611,\"segments\":[{\"z1\":1.0375850200653076,\"isOverlapped\":false,\"y1\":3.8362200260162354,\"isOverlapping\":false,\"x1\":0.71514403820037842,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"top\",\"z0\":1.0375850200653076,\"y0\":4.393805980682373,\"name\":null,\"x0\":1.5476164817810059},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":3.8362200260162354,\"isOverlapping\":false,\"x1\":0.71514403820037842,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.0375850200653076,\"y0\":3.8362200260162354,\"name\":null,\"x0\":0.71514403820037842},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":4.393805980682373,\"isOverlapping\":true,\"x1\":1.5476164817810059,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":3.8362200260162354,\"name\":null,\"x0\":0.71514403820037842},{\"z1\":1.0375850200653076,\"isOverlapped\":false,\"y1\":4.393805980682373,\"isOverlapping\":false,\"x1\":1.5476164817810059,\"typeIdentifier\":\"door\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":4.393805980682373,\"name\":null,\"x0\":1.5476164817810059}],\"geometryIdentifier\":\"rectangle\",\"height\":2.1485161781311035,\"typeIdentifier\":\"door\",\"width\":1.0019543170928955,\"perimeter\":6.300940990447998,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":0.48191863298416138,\"segments\":[{\"z1\":0.81485694646835327,\"isOverlapped\":false,\"y1\":2.1259851455688477,\"isOverlapping\":false,\"x1\":4.0352635383605957,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":0.81485694646835327,\"y0\":1.6068243980407715,\"name\":null,\"x0\":3.9612021446228027},{\"z1\":-0.10410428047180176,\"isOverlapped\":false,\"y1\":2.1259851455688477,\"isOverlapping\":false,\"x1\":4.0352635383605957,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":0.81485694646835327,\"y0\":2.1259851455688477,\"name\":null,\"x0\":4.0352635383605957},{\"z1\":-0.10410428047180176,\"isOverlapped\":false,\"y1\":1.6068243980407715,\"isOverlapping\":false,\"x1\":3.9612021446228027,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-0.10410428047180176,\"y0\":2.1259851455688477,\"name\":null,\"x0\":4.0352635383605957},{\"z1\":0.81485694646835327,\"isOverlapped\":false,\"y1\":1.6068243980407715,\"isOverlapping\":false,\"x1\":3.9612021446228027,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-0.10410428047180176,\"y0\":1.6068243980407715,\"name\":null,\"x0\":3.9612021446228027}],\"geometryIdentifier\":\"rectangle\",\"height\":0.91896122694015503,\"typeIdentifier\":\"window\",\"width\":0.52441680431365967,\"perimeter\":2.8867559432983398,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":1.499756932258606,\"segments\":[{\"z1\":1.3922663927078247,\"isOverlapped\":false,\"y1\":3.3258028030395508,\"isOverlapping\":false,\"x1\":3.381610631942749,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":1.3922663927078247,\"y0\":2.6827182769775391,\"name\":null,\"x0\":3.8296055793762207},{\"z1\":-0.521309494972229,\"isOverlapped\":false,\"y1\":3.3258028030395508,\"isOverlapping\":false,\"x1\":3.381610631942749,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.3922663927078247,\"y0\":3.3258028030395508,\"name\":null,\"x0\":3.381610631942749},{\"z1\":-0.521309494972229,\"isOverlapped\":false,\"y1\":2.6827182769775391,\"isOverlapping\":false,\"x1\":3.8296055793762207,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-0.521309494972229,\"y0\":3.3258028030395508,\"name\":null,\"x0\":3.381610631942749},{\"z1\":1.3922663927078247,\"isOverlapped\":false,\"y1\":2.6827182769775391,\"isOverlapping\":false,\"x1\":3.8296055793762207,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-0.521309494972229,\"y0\":2.6827182769775391,\"name\":null,\"x0\":3.8296055793762207}],\"geometryIdentifier\":\"rectangle\",\"height\":1.9135758876800537,\"typeIdentifier\":\"window\",\"width\":0.78374564647674561,\"perimeter\":5.3946428298950195,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":1.4341120719909668,\"segments\":[{\"z1\":1.4108841419219971,\"isOverlapped\":false,\"y1\":4.0856881141662598,\"isOverlapping\":false,\"x1\":2.8522484302520752,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":1.4108841419219971,\"y0\":3.4756536483764648,\"name\":null,\"x0\":3.277219295501709},{\"z1\":-0.51806968450546265,\"isOverlapped\":false,\"y1\":4.0856881141662598,\"isOverlapping\":false,\"x1\":2.8522484302520752,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.4108841419219971,\"y0\":4.0856881141662598,\"name\":null,\"x0\":2.8522484302520752},{\"z1\":-0.51806968450546265,\"isOverlapped\":false,\"y1\":3.4756536483764648,\"isOverlapping\":false,\"x1\":3.277219295501709,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-0.51806968450546265,\"y0\":4.0856881141662598,\"name\":null,\"x0\":2.8522484302520752},{\"z1\":1.4108841419219971,\"isOverlapped\":false,\"y1\":3.4756536483764648,\"isOverlapping\":false,\"x1\":3.277219295501709,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-0.51806968450546265,\"y0\":3.4756536483764648,\"name\":null,\"x0\":3.277219295501709}],\"geometryIdentifier\":\"rectangle\",\"height\":1.9289538860321045,\"typeIdentifier\":\"window\",\"width\":0.74346643686294556,\"perimeter\":5.3448405265808105,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":1.2652105093002319,\"segments\":[{\"z1\":1.3578252792358398,\"isOverlapped\":false,\"y1\":4.500603199005127,\"isOverlapping\":false,\"x1\":1.773688793182373,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":1.3578252792358398,\"y0\":4.3602733612060547,\"name\":null,\"x0\":2.4490580558776855},{\"z1\":-0.47636008262634277,\"isOverlapped\":false,\"y1\":4.500603199005127,\"isOverlapping\":false,\"x1\":1.773688793182373,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":1.3578252792358398,\"y0\":4.500603199005127,\"name\":null,\"x0\":1.773688793182373},{\"z1\":-0.47636008262634277,\"isOverlapped\":false,\"y1\":4.3602733612060547,\"isOverlapping\":false,\"x1\":2.4490580558776855,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-0.47636008262634277,\"y0\":4.500603199005127,\"name\":null,\"x0\":1.773688793182373},{\"z1\":1.3578252792358398,\"isOverlapped\":false,\"y1\":4.3602733612060547,\"isOverlapping\":false,\"x1\":2.4490580558776855,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-0.47636008262634277,\"y0\":4.3602733612060547,\"name\":null,\"x0\":2.4490580558776855}],\"geometryIdentifier\":\"rectangle\",\"height\":1.8341853618621826,\"typeIdentifier\":\"window\",\"width\":0.68979424238204956,\"perimeter\":5.0479593276977539,\"name\":null,\"orientationIdentifier\":\"vertical\"},{\"closed\":true,\"area\":1.5648795366287231,\"segments\":[{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.560884952545166,\"isOverlapping\":false,\"x1\":-0.86862063407897949,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.9214745759963989,\"name\":null,\"x0\":-0.40185087919235229},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":0.86102789640426636,\"isOverlapping\":false,\"x1\":-0.32796603441238403,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.560884952545166,\"name\":null,\"x0\":-0.86862063407897949},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.2216174602508545,\"isOverlapping\":false,\"x1\":0.13880372047424316,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":0.86102789640426636,\"name\":null,\"x0\":-0.32796603441238403},{\"z1\":-1.1109310388565063,\"isOverlapped\":false,\"y1\":1.9214745759963989,\"isOverlapping\":false,\"x1\":-0.40185087919235229,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"base\",\"z0\":-1.1109310388565063,\"y0\":1.2216174602508545,\"name\":null,\"x0\":0.13880372047424316},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.9214745759963989,\"isOverlapping\":false,\"x1\":-0.40185087919235229,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":1.9214745759963989,\"name\":null,\"x0\":-0.40185087919235229},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.560884952545166,\"isOverlapping\":false,\"x1\":-0.86862063407897949,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":1.560884952545166,\"name\":null,\"x0\":-0.86862063407897949},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":0.86102789640426636,\"isOverlapping\":false,\"x1\":-0.32796603441238403,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":0.86102789640426636,\"name\":null,\"x0\":-0.32796603441238403},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.2216174602508545,\"isOverlapping\":false,\"x1\":0.13880372047424316,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"orthogonal\",\"z0\":-1.1109310388565063,\"y0\":1.2216174602508545,\"name\":null,\"x0\":0.13880372047424316},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.560884952545166,\"isOverlapping\":false,\"x1\":-0.86862063407897949,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":-0.22943115234375,\"y0\":1.9214745759963989,\"name\":null,\"x0\":-0.40185087919235229},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":0.86102789640426636,\"isOverlapping\":false,\"x1\":-0.32796603441238403,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":-0.22943115234375,\"y0\":1.560884952545166,\"name\":null,\"x0\":-0.86862063407897949},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.2216174602508545,\"isOverlapping\":false,\"x1\":0.13880372047424316,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":-0.22943115234375,\"y0\":0.86102789640426636,\"name\":null,\"x0\":-0.32796603441238403},{\"z1\":-0.22943115234375,\"isOverlapped\":false,\"y1\":1.9214745759963989,\"isOverlapping\":false,\"x1\":-0.40185087919235229,\"typeIdentifier\":\"wall\",\"positionIdentifier\":\"top\",\"z0\":-0.22943115234375,\"y0\":1.2216174602508545,\"name\":null,\"x0\":0.13880372047424316}],\"geometryIdentifier\":\"rectangularPrism\",\"height\":0.88149988651275635,\"typeIdentifier\":\"other\",\"width\":0.58982956409454346,\"length\":0.88436830043792725,\"perimeter\":9.42279052734375,\"name\":null,\"orientationIdentifier\":\"horizontal\"}],\"perimeter\":20.429161276410657,\"name\":\"Test\",\"createdAt\":1514129246.240447}]",
    "files": "[\"https:\\/\\/stpportalstorage.blob.core.windows.net\\/0f32ad08-624d-418a-b255-fff0c37742e3\\/0F32AD08-624D-418A-B255-FFF0C37742E3_report_1513983661.pdf\",\"https:\\/\\/stpportalstorage.blob.core.windows.net\\/0f32ad08-624d-418a-b255-fff0c37742e3\\/0F32AD08-624D-418A-B255-FFF0C37742E3_report_1513983707.pdf\",\"https:\\/\\/stpportalstorage.blob.core.windows.net\\/0f32ad08-624d-418a-b255-fff0c37742e3\\/0F32AD08-624D-418A-B255-FFF0C37742E3_report_1513983729.pdf\",\"https:\\/\\/stpportalstorage.blob.core.windows.net\\/0f32ad08-624d-418a-b255-fff0c37742e3\\/0F32AD08-624D-418A-B255-FFF0C37742E3_report_1513983824.pdf\",\"https:\\/\\/stpportalstorage.blob.core.windows.net\\/0f32ad08-624d-418a-b255-fff0c37742e3\\/0F32AD08-624D-418A-B255-FFF0C37742E3_report_1514129322.pdf\"]",
    "company": "57f52360-cc5a-4eda-8329-6c89531868db",
    "email": "dj@smartpicture3d.com",
    "name": "D G",
    "deviceInfo": "{\"systemVersion\":\"11.2.1\",\"systemName\":\"iOS\",\"model\":\"iPhone 8 China\\/Japan\",\"name\":\"Dejan's iPhone\"}",
    "notes": "H",
    "companyName": null,
    "projectName": "Default Project",
    "appVersion": "2.0.12 (826)",
    "units": "feetInchesFractional",
    "reportStatus": "free",
    "photos": "[]"
};

// Preprocessing
// Parse room data
var roomData = JSON.parse(plnarData.rooms);
if (roomData.length == 0) exit(); // Bail if no rooms

// scene .. NOTE WILL MOVE LATER
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

for (const room of roomData) {
    if (room.roomObjects.length == 0) exit(); // Bail if no objects

    // Create objects and add to scene
    var ceilingHeight = room.ceilingHeight;
    var roomObjects = resetFloorElevation(room.roomObjects);
    var floorPlan = buildFloorPlan(roomObjects);
    var openings = getOpenings(roomObjects);
    var walls =  buildWalls(roomObjects, ceilingHeight, openings);

    addGroundToScene(scene)
    addFloorplanToScene(scene, floorPlan);
    addWallsToScene(scene, walls)
}

function resetFloorElevation(roomObjects) {
    // Get elevation (z)
    var elevation;
    for (const object of roomObjects) {
        if (object.typeIdentifier == "floorPlan") {
            elevation = object.segments[0].z0;
            break
        }
    }
    // Reset elevations
    for (var i=0; i < roomObjects.length; i++) {
        for (var j=0; j < roomObjects[i].segments.length; j++) {
            roomObjects[i].segments[j].z0 -= elevation;
            roomObjects[i].segments[j].z1 -= elevation
        }
    }
    return roomObjects
}

function buildFloorPlan(roomObjects) {
    for (const object of roomObjects) {
        if (object.typeIdentifier == "floorPlan") {
            var floorPlan = parseSegmentsToFloorplan(object.segments);
            return floorPlan
        }
    }
}

function getOpenings(roomObjects) {
    var openings = [];
    for (const object of roomObjects) {
        if (object.typeIdentifier == "door" || object.typeIdentifier == "opening" || object.typeIdentifier == "window") {
            console.log(object.typeIdentifier);
            openings.push(object)
        }
    }
    return openings
}

function buildWalls(roomObjects, ceilingHeight, openings) {
    var walls = [];
    for (const object of roomObjects) {
        if (object.typeIdentifier == "ceiling") {
            var walls = parseSegmentsToWalls(object.segments, ceilingHeight, openings);
            return walls
        }
    }
}


function parseSegmentsToFloorplan(segments) {
    positions = [];
    for (const [index, value] of segments.entries()) {
        if (index == 0) positions.push(new THREE.Vector2(-value.x0, value.y0)); // Height is z
        positions.push(new THREE.Vector2(-value.x1, value.y1))
    }
    var shape = new THREE.Shape(positions);
    var geometry = new THREE.ShapeGeometry(shape);
    const material = new THREE.MeshPhongMaterial({
        color: 0x6083c2,
        side: THREE.DoubleSide,
        wireframe: false
    });
    var floorPlan = new THREE.Mesh(geometry, material);
    return floorPlan
}

function parseSegmentsToWalls(segments, ceilingHeight, openings) {
    walls = [];
    for (const segment of segments) {
        var segmentOpenings = getOpeningsForSegment(segment, ceilingHeight, openings);
        var wall = getWallFromSegment(segment, segmentOpenings);
        walls.push(wall)
    }
    return walls
}

function getOpeningsForSegment(segment, ceilingHeight, openings) {
    var segmentOpenings = [];
    var segmentMinX = Math.min(segment.x0, segment.x1);
    var segmentMaxX = Math.max(segment.x0, segment.x1);
    var segmentMinY = Math.min(segment.y0, segment.y1);
    var segmentMaxY = Math.max(segment.y0, segment.y1);
    for (const opening of openings) {
        var openingInWall = true;
        for (const openingSegments of opening.segments) {
            if (!((openingSegments.x0 >= segmentMinX && openingSegments.x0 <= segmentMaxX)
                && (openingSegments.x1 >= segmentMinX && openingSegments.x1 <= segmentMaxX)
                && (openingSegments.y0 >= segmentMinY && openingSegments.y0 <= segmentMaxY)
                && (openingSegments.y1 >= segmentMinY && openingSegments.y1 <= segmentMaxY))){
                    openingInWall = false
            }
        }
        if(openingInWall) {
            console.log(opening.typeIdentifier);
            segmentOpenings.push(opening)
        }
    }
    return segmentOpenings
}

function getWallFromSegment(segment, openings) {
    // Width and Height
    var segmentVector = new THREE.Vector3(segment.x1 - segment.x0, segment.y1 - segment.y0, 0);
    segment.width = segmentVector.distanceTo(new THREE.Vector3());
    segment.height = ceilingHeight
    // Create geometry
    var geometry = new THREE.BoxGeometry( segment.width, segment.height, 0.002 );
    geometry = addHolesToGeometry(geometry, segment, openings);
    // Create material
    const material = new THREE.MeshPhongMaterial({
        color: 0x6083c2,
        side: THREE.DoubleSide,
        wireframe: false
    });
    material.transparent = true;
    material.opacity = 0.5;
    // Create mesh
    var wall = new THREE.Mesh(geometry, material);
    // Position
    wall.position.x = -(segment.x0+segment.x1)/2;
    wall.position.y = (segment.y0+segment.y1)/2;
    wall.position.z = ceilingHeight/2;
    // Rotation
    var angle = -Math.sign(segmentVector.y) * segmentVector.angleTo(new THREE.Vector3(1, 0, 0));
    wall.rotation.x = Math.PI / 2;
    wall.rotation.y = angle;

    return wall
}

function addHolesToGeometry(geometry, segment, openings) {
    for(var [index, opening] of openings.entries()) {
        var openingSegment0 = opening.segments[0];
        var openingSegment1 = opening.segments[1];
        // Width
        var openingWidthVector = new THREE.Vector3(openingSegment0.x1 - openingSegment0.x0, openingSegment0.y1 - openingSegment0.y0, openingSegment0.z1 - openingSegment0.z0);
        var width = openingWidthVector.distanceTo(new THREE.Vector3());
        // Height
        var openingHeightVector = new THREE.Vector3(openingSegment1.x1 - openingSegment1.x0, openingSegment1.y1 - openingSegment1.y0, openingSegment1.z1 - openingSegment1.z0);
        var height = openingHeightVector.distanceTo(new THREE.Vector3());
        // Base position
        var openingBaseVector = new THREE.Vector2(openingSegment0.x0 - segment.x0, openingSegment0.y0 - segment.y0);
        var baseWidth =  openingBaseVector.distanceTo(new THREE.Vector2());
        var baseHeight = Math.min(openingSegment0.z0, openingSegment1.z1);
        var positions = [];
        positions.push(new THREE.Vector2(baseWidth,baseHeight));
        positions.push(new THREE.Vector2(baseWidth+width,baseHeight));
        positions.push(new THREE.Vector2(baseWidth+width,baseHeight+height));
        positions.push(new THREE.Vector2(baseWidth,baseHeight+height));
        positions.push(new THREE.Vector2(baseWidth,baseHeight));
        // Create shape + geometry
        var openingShape = new THREE.Shape(positions);
        openingShape.closed = true;
        //var openingGeometry = new THREE.ShapeGeometry(openingShape);
        var extrudeSettings = {
            amount			: 0.1,
            //steps			: 1,
            bevelEnabled	: false
        };
        //var openingGeometry = new THREE.ExtrudeGeometry( openingShape, extrudeSettings );
        var openingGeometry = new THREE.BoxGeometry( width, height, 0.1 );
        var openingMesh = new THREE.Mesh(openingGeometry);
        openingMesh.position.x = (-segment.width + width)/2 + baseWidth
        openingMesh.position.y = (-segment.height + height)/2 + baseHeight
        openingMesh.position.z = -0.005;
        var openingMeshBSP = new ThreeBSP(openingMesh);
        // CSG subtraction
        var mesh = new THREE.Mesh(geometry);
        var meshBSP = new ThreeBSP(mesh);
        geometry = meshBSP.subtract(openingMeshBSP).toGeometry()
    }
    return geometry
}

function addGroundToScene(scene) {
    var geometry = new THREE.PlaneGeometry(1000.0, 1000.0)
    var material = new THREE.MeshBasicMaterial({
        color: 0xD3D3D3,
        side: THREE.DoubleSide
    })
    var ground = new THREE.Mesh(geometry, material);
    ground.position.z = -0.001
    scene.add(ground)
}

function addFloorplanToScene(scene, floorPlan) {
    scene.add(floorPlan)
}

function addWallsToScene(scene, walls) {
    for (const wall of walls) {
        scene.add(wall)
    }
}

// camera
const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
camera.position.set(0, 0, 20);
scene.add(camera);

// light
var light = new THREE.PointLight(0xffffff, 0.8);
camera.add(light);

// renderer
const renderer = new THREE.WebGLRenderer({
    antialias: true
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x20252f);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// controls
const controls = new THREE.OrbitControls(camera, renderer.domElement);

// Animate
animate();

window.addEventListener('resize', onResize);

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);

}

function animate() {
    requestAnimationFrame(animate);
    render();
}

function render() {
    renderer.render(scene, camera);
}

////////////////////////////// EXPORT ///////////////////////////////////////////////////////////
// Instantiate a exporter
// var exporter = new THREE.GLTFExporter();
//
// // Parse the input and generate the glTF output
// var options={}
// exporter.parse( scene, function ( gltf ) {
//     var output = JSON.stringify( gltf, null, 2 );
//     console.log( output );
//     saveString( output, 'scene.gltf' );
// }, options );
//
// // Savstring Function
// function saveString( text, filename ) {
//     save( new Blob( [ text ], { type: 'text/plain' } ), filename );
// }
//
// // Support
// var link = document.createElement( 'a' );
// link.style.display = 'none';
// document.body.appendChild( link ); // Firefox workaround, see #6594
//
// function save( blob, filename ) {
//     link.href = URL.createObjectURL( blob );
//     link.download = filename;
//     link.click();
// }
